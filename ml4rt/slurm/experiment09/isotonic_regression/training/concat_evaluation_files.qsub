#!/bin/tcsh

#SBATCH --job-name="concat_evaluation_files"
#SBATCH --partition="fge"
#SBATCH --account="rda-ghpcs"
#SBATCH --qos="batch"
#SBATCH --ntasks=1
#SBATCH --nodes=1
#SBATCH --cpus-per-task=1
#SBATCH --mem=160G
#SBATCH --time=01:00:00
#SBATCH --array=1
##SBATCH --exclude=h31n03,h28n12
##SBATCH --exclude=h29n01,h26n05,h28n06,h29n07,h30n03,h30n15
#SBATCH --mail-type=BEGIN,END,FAIL
#SBATCH --mail-user=ryan.lagerquist@noaa.gov
#SBATCH --output=concat_evaluation_files_%A_%a.out

module load cuda/10.1
source /scratch2/BMC/gsd-hpcs/Jebb.Q.Stewart/conda3.7/etc/profile.d/conda.csh
conda activate base

set CODE_DIR_NAME="/scratch1/RDARCH/rda-ghpcs/Ryan.Lagerquist/ml4rt_standalone/ml4rt"
set TOP_MODEL_DIR_NAME="/scratch1/RDARCH/rda-ghpcs/Ryan.Lagerquist/ml4rt_models/experiment09"

set DENSE_LAYER_COUNTS=(4)
set DENSE_LAYER_DROPOUT_RATES=(0.000)
set L2_WEIGHTS=(0.0000001000)

set dense_layer_count=${DENSE_LAYER_COUNTS[1]}
set dense_layer_dropout_rate=${DENSE_LAYER_DROPOUT_RATES[1]}
set l2_weight=${L2_WEIGHTS[1]}

set dense_layer_count_string=`printf "%d" $dense_layer_count`
set dense_layer_dropout_string=`printf "%.3f" $dense_layer_dropout_rate`
set l2_weight_string=`printf "%.10f" $l2_weight`

set top_model_dir_name="${TOP_MODEL_DIR_NAME}/num-dense-layers=${dense_layer_count_string}_dense-dropout=${dense_layer_dropout_string}_l2-weight=${l2_weight_string}"

set model_file_names={${top_model_dir_name}/model*.h5}
set model_file_name=${model_file_names[$#model_file_names]}
set model_dir_name=`echo $model_file_name | rev | cut -c 4- | rev`

set top_evaluation_dir_name="${model_dir_name}/isotonic_regression/training_eval_with_bootstrap"
set output_file_name="${top_evaluation_dir_name}/evaluation.nc"

python3 -u "${CODE_DIR_NAME}/concat_evaluation_files.py" \
--input_file_names "${top_evaluation_dir_name}/bootstrap_reps_000-009/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_010-019/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_020-029/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_030-039/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_040-049/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_050-059/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_060-069/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_070-079/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_080-089/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_090-099/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_100-109/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_110-119/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_120-129/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_130-139/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_140-149/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_150-159/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_160-169/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_170-179/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_180-189/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_190-199/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_200-209/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_210-219/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_220-229/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_230-239/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_240-249/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_250-259/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_260-269/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_270-279/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_280-289/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_290-299/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_300-309/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_310-319/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_320-329/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_330-339/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_340-349/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_350-359/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_360-369/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_370-379/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_380-389/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_390-399/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_400-409/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_410-419/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_420-429/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_430-439/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_440-449/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_450-459/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_460-469/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_470-479/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_480-489/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_490-499/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_500-509/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_510-519/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_520-529/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_530-539/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_540-549/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_550-559/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_560-569/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_570-579/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_580-589/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_590-599/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_600-609/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_610-619/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_620-629/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_630-639/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_640-649/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_650-659/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_660-669/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_670-679/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_680-689/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_690-699/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_700-709/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_710-719/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_720-729/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_730-739/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_740-749/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_750-759/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_760-769/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_770-779/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_780-789/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_790-799/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_800-809/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_810-819/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_820-829/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_830-839/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_840-849/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_850-859/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_860-869/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_870-879/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_880-889/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_890-899/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_900-909/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_910-919/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_920-929/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_930-939/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_940-949/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_950-959/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_960-969/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_970-979/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_980-989/evaluation.nc" "${top_evaluation_dir_name}/bootstrap_reps_990-999/evaluation.nc" \
--output_file_name="${output_file_name}"
